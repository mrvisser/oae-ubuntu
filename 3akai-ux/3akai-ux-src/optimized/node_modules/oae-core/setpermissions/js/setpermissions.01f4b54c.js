define(["jquery","oae.core"],function(e,t){return function(n,r,i){var s=e("#"+n),o=null,u=function(e){return e==="discussion"?t.api.i18n.translate("__MSG__MY_DISCUSSIONS__"):t.api.i18n.translate("__MSG__MY_LIBRARY__")},a=function(){e(document).trigger("oae.setpermissions.cancel."+n)},f=function(){var r=t.api.util.autoSuggest().getSelection(s),a=null;if(t.data.me.id!==o.id){var f=_.some(r,function(e){return e.id===o.id});f&&(a=o.displayName)}var l=[];e.each(r,function(e,n){n.id!==t.data.me.id&&n.id!==o.id&&l.push(n)});var c=e('#setpermissions-container input[type="radio"]:checked',s).val();e(document).trigger("oae.setpermissions.changed."+n,{visibility:c,viewers:r,summary:t.api.util.template().render("#setpermissions-summary-template",{context:a,count:i.count,mylibrary:u(i.type),resourceType:i.type,shared:l,visibility:c})})},l=function(n){var r=[{displayName:u(i.type),id:t.data.me.id,fixed:!0}];o&&o.id!==t.data.me.id&&r.push(e.extend({fixed:!0},o)),t.api.util.autoSuggest().setup(e("#setpermissions-share",s),{preFill:r},null,n)},c=function(){t.api.util.template().render("#setpermissions-template",i,"#setpermissions-container"),e("#setpermissions-savepermissions",s).on("click",f),e("#setpermissions-cancelpermissions",s).on("click",a),e(document).on("oae.context.send.setpermissions",function(e,t){o=t,l(f)}),e(document).trigger("oae.context.get","setpermissions")};c()}});