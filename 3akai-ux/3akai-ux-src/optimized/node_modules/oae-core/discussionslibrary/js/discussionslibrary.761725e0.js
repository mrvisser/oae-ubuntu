define(["jquery","oae.core","jquery.history"],function(e,t){return function(n,r,i){var s=e("#"+n),o=!1,u=function(){o&&o.kill();var n=History.getState().data.query;e("#discussionslibrary-search-query",s).val(n);var r=null;i.canManage&&!n&&(r=t.api.util.template().render(e("#discussionslibrary-list-actions-template",s)));var u="/api/discussion/library/"+i.principalId;n&&(u="/api/search/discussion-library/"+i.principalId),o=e(".oae-list",s).infiniteScroll(u,{limit:12,q:n},"#discussionslibrary-template",{initialContent:r,postProcessor:function(e){return e.query=n,e},emptyListProcessor:function(){t.api.util.template().render(e("#discussionslibrary-noresults-template",s),{query:n},e(".oae-list",s))}})},a=function(){t.data.me.anon?e(".oae-list-options-toggle",s).prop("disabled",!0):t.api.util.template().render(e("#discussionlibrary-list-options-actions-template",s),{widgetData:i},e(".oae-list-options-actions",s))},f=function(){var n=e("#discussionslibrary-search-query",e(this)).val(),r=e.extend({},History.getState().data,{query:n}),i=e.url(History.getState().cleanUrl).attr("path")+"?q="+t.api.util.security().encodeForURL(n);return History.pushState(r,e("title").text(),i),!1},l=function(){s.on("submit","#discussionslibrary-search-form",f),e(window).on("statechange",function(){s.is(":visible")&&u()}),e(window).on("oae.deleteresources.done",function(){s.is(":visible")&&(u(),e("#discussionslibrary-selectall",s).prop("checked",!1))})};l(),a(),u()}});