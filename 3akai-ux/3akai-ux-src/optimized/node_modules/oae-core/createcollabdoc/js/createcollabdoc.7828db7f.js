define(["jquery","oae.core"],function(e,t){return function(n){var r=e("#"+n),i=t.api.config.getValue("oae-content","visibility","collabdocs"),s=[],o=function(){e("#createcollabdoc-modal",r).on("hidden",function(n){var i=e("#createcollabdoc-form",r);i[0].reset(),t.api.util.validation().clear(i),f()})},u=function(){var n={submitHandler:c};t.api.util.validation().validate(e("#createcollabdoc-form",r),n)},a=function(){e(".modal-body > div:visible",r).hide(),e("#createcollabdoc-form > .modal-footer",r).hide(),e("#createcollabdoc-permissions-container",r).show()},f=function(){e(".modal-body > div:visible",r).hide(),e("#createcollabdoc-form > .modal-footer",r).show(),e("#createcollabdoc-overview-container",r).show()},l=function(){var n=e("#createcollabdoc-permissions-container",r);n.html("");var o=t.api.util.generateId();e(document).on("oae.setpermissions.changed."+o,function(t,n){i=n.visibility,e(n.viewers).each(function(e,t){s.push(t.id)}),e("#createcollabdoc-permissions-summary",r).html(n.summary),f()}),e(document).on("oae.setpermissions.cancel."+o,f),t.api.widget.insertWidget("setpermissions",o,n,!1,{count:1,type:"collabdoc",visibility:i})},c=function(){e("#createcollabdoc-form *",r).prop("disabled",!0);var n=e.trim(e("#createcollabdoc-name",r).val());return t.api.content.createCollabDoc(n,"",i,s,[],function(n,i){n?(e("#createcollabdoc-form *",r).prop("disabled",!1),t.api.util.notification(t.api.i18n.translate("__MSG__DOCUMENT_NOT_CREATED__","createcollabdoc"),t.api.i18n.translate("__MSG__DOCUMENT_COULD_NOT_BE_CREATED__","createcollabdoc"),"error")):window.location=i.profilePath}),!1},h=function(){e(document).on("click",".oae-trigger-createcollabdoc",function(){e("#createcollabdoc-modal",r).modal({backdrop:"static"})}),e("#createcollabdoc-modal",r).on("shown",function(){e("#createcollabdoc-name",r).focus(),l()}),e("#createcollabdoc-change-permissions",r).on("click",a)};h(),u(),o()}});