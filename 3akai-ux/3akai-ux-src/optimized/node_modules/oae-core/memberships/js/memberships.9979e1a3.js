define(["jquery","oae.core","jquery.history"],function(e,t){return function(n,r,i){var s=e("#"+n),o=!1,u=function(){o&&o.kill();var n=History.getState().data.query;e("#memberships-search-query",s).val(n);var r=null;i.canManage&&!n&&(r=t.api.util.template().render(e("#memberships-list-actions-template",s)));var u="/api/user/"+i.principalId+"/memberships";n&&(u="/api/search/memberships/"+i.principalId),o=e(".oae-list",s).infiniteScroll(u,{limit:12,q:n},"#memberships-template",{initialContent:r,postProcessor:function(e){return e.query=n,e.canManage=i.canManage,e},emptyListProcessor:function(){t.api.util.template().render(e("#memberships-noresults-template",s),{query:n},e(".oae-list",s))}})},a=function(){t.data.me.anon?e(".oae-list-options-toggle",s).prop("disabled",!0):t.api.util.template().render(e("#memberships-list-options-actions-template",s),{widgetData:i},e(".oae-list-options-actions",s))},f=function(){var n=e("#memberships-search-query",e(this)).val(),r=e.extend({},History.getState().data,{query:n});return History.pushState(r,null,e.url().attr("path")+"?q="+t.api.util.security().encodeForURL(n)),!1},l=function(){s.on("submit","#memberships-search-form",f),e(window).on("statechange",function(){s.is(":visible")&&u()}),e(window).on("oae.leavegroup.done",u)};l(),a(),u()}});