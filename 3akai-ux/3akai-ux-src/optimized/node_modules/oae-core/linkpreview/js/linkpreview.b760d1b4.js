define(["jquery","oae.core","jquery.oembed"],function(e,t){return function(n,r,i){var s=e("#"+n),o={blip:RegExp("blip\\.tv/.+"),dailymotion:RegExp("dailymotion\\.com/.+"),deviantart:RegExp("deviantart.com/.+"),dribble:RegExp("dribbble.com/shots/.+"),flickr:RegExp("flickr\\.com/photos/.+"),hulu:RegExp("hulu\\.com/watch/.*"),ifixit:RegExp("ifixit.com/.+"),imgly:RegExp("img\\.ly/.+"),instagram:RegExp("instagr\\.?am(\\.com)?/.+"),pastebin:RegExp("pastebin\\.com/[\\S]{8}"),pinterest:RegExp("pinterest.com/pin/.+"),prezi:RegExp("prezi.com/.*"),scribd:RegExp("scribd\\.com/.+"),slideshare:RegExp("slideshare.net"),soundcloud:RegExp("soundcloud.com/.+"),speakerdeck:RegExp("speakerdeck.com/.+"),ted:RegExp("ted.com/talks/.+"),twitgoocom:RegExp("twitgoo\\.com/.+"),twitpic:RegExp("twitpic.com/.+"),vimeo:RegExp("vimeo.com/.+"),youtube:RegExp("youtube\\.com/watch.+v=[\\w-]+&?")},u=function(){e.fn.updateOEmbedProvider("dribbble",null,null,null,{templateData:function(n){return t.api.util.template().render(e("#linkpreview-image-template",s),{img:n.image_url,linkProfile:i})}}),e.fn.updateOEmbedProvider("img.ly","photo",["img\\.ly/.+"],"//img.ly/show/large/$1",{embedtag:{tag:"img"}}),e.fn.updateOEmbedProvider("twitgoo.com","photo",["twitgoo\\.com/.+"],"http://twitgoo.com/show/img/$1",{embedtag:{tag:"img"}}),e.fn.updateOEmbedProvider("opengraph",null,null,null,{yql:{xpath:"//meta|//title|//link",from:"html",datareturn:function(n){var r=e("<p/>");if(n["og:url"].match(o.ted)){var u=n["og:url"].replace("www.","embed.");r.append(t.api.util.template().render(e("#linkpreview-iframe-template",s),{link:u}))}else n["og:image"]&&(n["og:site_name"]==="TwitPic"&&(n["og:image"]=n["og:image"].replace("thumb","large")),r.append(t.api.util.template().render(e("#linkpreview-image-template",s),{img:n["og:image"],linkProfile:i})));return r}}})},a=function(){i.previews.embeddable===!1?t.api.util.template().render(e("#linkpreview-default-template",s),{linkProfile:i},e("#linkpreview-container"),s):t.api.util.template().render(e("#linkpreview-iframe-template",s),{link:i.link},e("#linkpreview-container"),s)},f=function(){e("#linkpreview-container",s).oembed(i.link,{includeHandle:!1,embedMethod:"fill"})},l=function(){var t=!1;e.each(o,function(e,n){if(n.test(i.link))return t=!0,!1}),t?f():a()};u(),l()}});