define(["jquery","oae.core","jquery.fileupload","jquery.iframe-transport"],function(e,t){return function(n,r){var i=e("#"+n),s=null,o=!e.support.xhrFileUpload&&!e.support.xhrFormDataFileUpload,u=function(){e("#uploadnewversion-form",i)[0].reset(),e("#uploadnewversion-dropzone",i).show(),e("#uploadnewversion-progress",i).hide(),o||(e(".progress",i).hide(),a(0)),e("#uploadnewversion-browse-button",i).removeClass("oae-focus")},a=function(t){e(".bar",i).css("width",t+"%")},f=function(e,t){var n=!1,r=t.files[0];o?r.name&&(n=!0):r.size>0&&r.name&&(n=!0),n&&(s=r,c())},l=function(t,n){var r={url:"/api/content/"+n.id+"/newversion",dropZone:e("#uploadnewversion-dropzone",i),replaceFileInput:!1,forceIframeTransport:o,add:f,progress:function(e,t){o||a(t.loaded/t.total*100)}};e("#uploadnewversion-input",i).fileupload(r)},c=function(){return e("#uploadnewversion-dropzone",i).hide(),e("#uploadnewversion-progress",i).show(),o?e(".icon-spinner",i).show():e(".progress",i).show(),e("#uploadnewversion-modal",i).modal("lock"),t.api.content.uploadNewVersion(e("#uploadnewversion-input",i),s,function(n,r){e(document).trigger("oae.content.update",r),o||a(100),e("#uploadnewversion-modal",i).modal("unlock"),e("#uploadnewversion-modal",i).modal("hide"),t.api.util.notification(t.api.i18n.translate("__MSG__VERSION_UPLOADED__","uploadnewversion"),t.api.i18n.translate("__MSG__VERSION_SUCCESSFULLY_UPLOADED__","uploadnewversion"))}),!1},h=function(){e(document).on("click",".oae-trigger-uploadnewversion",function(){e("#uploadnewversion-modal",i).modal({backdrop:"static"}),e(document).trigger("oae.context.get","uploadnewversion")}),e(document).on("oae.context.send.uploadnewversion",l),e(".icon-spinner",i).hide(),e("#uploadnewversion-modal",i).on("hidden",u)};h()}});