define(["jquery","oae.core"],function(e,t){return function(n){var r=e("#"+n),i=null,s=null,o=[],u=[],a=[],f=function(){e("#deleteresources-modal").on("hidden",function(t){o=[],u=[],a=[],l(0),e("#deleteresources-overview-container",r).hide(),e("#deleteresources-progress-container",r).show(),e("#deleteresources-modal-title",r).empty()})},l=function(t){e(".bar",r).css("width",t+"%")},c=function(n){t.api.util.template().render(e("#deleteresources-modal-title-template",r),{count:o.length,resourceType:i,resourceSubType:o[0].resourceSubType,view:n},e("#deleteresources-modal-title",r))},h=function(t){c("deleting"),l(0),e("#deleteresources-overview-container",r).hide(),e("#deleteresources-progress-container",r).show(),e("#deleteresources-modal",r).modal("lock");var n=u.length+a.length,i=0,s=0,o=function(e){e&&s++,i++,l(i/n*100),a.length!==0?d(a.pop(),o):u.length!==0?t?p(u.pop(),o):d(u.pop(),o):v(n,s)};a.length!==0?d(a.pop(),o):u.length!==0&&(t?p(u.pop(),o):d(u.pop(),o))},p=function(e,n){e.resourceType==="content"?t.api.content.deleteContent(e.id,n):e.resourceType==="discussion"&&t.api.discussion.deleteDiscussion(e.id,n)},d=function(e,n){e.resourceType==="content"?t.api.content.deleteContentFromLibrary(s.id,e.id,n):e.resourceType==="discussion"&&t.api.discussion.deleteDiscussionFromLibrary(s.id,e.id,n)},v=function(n,s){var u={count:n,errCount:s,resourceType:i,resourceSubType:o[0].resourceSubType},a=t.api.util.template().render(e("#deleteresources-notification-title-template",r),u),f=t.api.util.template().render(e("#deleteresources-notification-body-template",r),u);t.api.util.notification(a,f,s?"error":"success"),e("#deleteresources-modal",r).modal("unlock"),e("#deleteresources-modal",r).modal("hide"),e(document).trigger("oae.deleteresources.done")},m=function(){c("overview"),e("#deleteresources-progress-container",r).hide(),e("#deleteresources-overview-container",r).show(),y()},g=function(n,s){t.api.util.template().render(e("#deleteresources-overview-template",r),{canManage:s,hasManageAndMember:u.length>0&&a.length>0,resources:n,resourceType:i},e("#deleteresources-overview-container",r))},y=function(){if(a.length===0)return b();g(a,!1)},b=function(){if(u.length===0)return h(null);g(u,!0)},w=function(){c("gathering");var e=0,n=o.length,r=null;i==="content"?r=t.api.content.getContent:i==="discussion"&&(r=t.api.discussion.getDiscussion);var s=function(){r(o[e].id,function(r,i){r?t.api.util.notification(t.api.i18n.translate("__MSG__GATHERING_FAILED__","deleteresources"),t.api.i18n.translate("__MSG__GATHERING_FAILED_DESCRIPTION__","deleteresources"),"error"):(i.isManager?u.push(i):a.push(i),e++,l(e/n*100),e===n?m():s())})};s()},E=function(){e(document).on("click",".oae-trigger-deleteresources",function(){e("#deleteresources-modal",r).modal({backdrop:"static"}),i=e(this).attr("data-resourceType"),e(document).trigger("oae.context.get","deleteresources")}),e(document).on("oae.context.send.deleteresources",function(t,n){s=n,e(document).trigger("oae.list.getSelection","deleteresources")}),e(document).on("oae.list.sendSelection.deleteresources",function(e,t){o=t.results,w()}),r.on("click","#deleteresources-view-delete-library",b),r.on("click","#deleteresources-manage-delete-library",function(){h(!1)}),r.on("click","#deleteresources-manage-delete-system",function(){h(!0)})};f(),E()}});