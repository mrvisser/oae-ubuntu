define(["jquery","oae.core"],function(e,t){return function(n,r){var i=e("#"+n),s=function(){o(),u()},o=function(){var n=t.data.me.anon?"#topnavigation-left-anonymous-template":"#topnavigation-left-loggedin-template";t.api.util.template().render(n,null,e("#topnavigation-left"))},u=function(){var n=t.data.me.anon?"#topnavigation-right-anonymous-template":"#topnavigation-right-loggedin-template";e("#topnavigation-right").append(t.api.util.template().render(n))},a=function(){i.on("click","#topnavigation-signout",function(){t.api.authentication.logout(function(){window.location="/"})})},f=function(){i.on("click",".oae-skip-link",function(){return e(e(this).attr("href")).focus(),!1})},l=function(){e(document).on("submit","#topnavigation-search-form",function(){var n=e.trim(e("#topnavigation-search-query",e(this)).val());return window.location="/search/"+t.api.util.security().encodeForURL(n),!1})},c=function(){i.on("click","#topnavigation-signin",function(){setTimeout(function(){e("#topnavigation-signin-username").focus()},1)}),h()},h=function(){var n=e("#topnavigation-signin-form",i),r={messages:{"topnavigation-signin-username":{required:t.api.i18n.translate("__MSG__PLEASE_ENTER_YOUR_USERNAME__"),"topnavigation-failed-attempt":t.api.i18n.translate("__MSG__INVALID_USERNAME_OR_PASSWORD__")},"topnavigation-signin-password":t.api.i18n.translate("__MSG__PLEASE_ENTER_YOUR_PASSWORD__")},methods:{"topnavigation-failed-attempt":{method:function(e,t){return!1}}},submitHandler:p};t.api.util.validation().validate(n,r)},p=function(){e("#topnavigation-signin-button",i).show(),e("#topnavigation-signin-signing-in",i).hide(),t.api.authentication.login(e("#topnavigation-signin-username",i).val(),e("#topnavigation-signin-password",i).val(),function(t){if(t)e("#topnavigation-signin-signing-in",i).hide(),e("#topnavigation-signin-button",i).show(),e("#topnavigation-signin-username",i).addClass("topnavigation-failed-attempt"),e("#topnavigation-signin-form",i).valid(),e("#topnavigation-signin-username",i).removeClass("topnavigation-failed-attempt"),e("#topnavigation-signin-password",i).val(""),e("#topnavigation-signin-username",i).focus();else{var n=["/","/index"],r=window.location.pathname;e.url().param("url")?window.location=e.url().param("url"):n.indexOf(window.location.pathname)!==-1?window.location="/me":window.location.reload(!0)}})};s(),c(),a(),f(),l()}});