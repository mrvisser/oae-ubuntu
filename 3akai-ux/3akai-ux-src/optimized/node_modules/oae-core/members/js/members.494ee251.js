define(["jquery","oae.core","jquery.history"],function(e,t){return function(n,r,i){var s=e("#"+n),o=!1,u=function(){o&&o.kill();var n=History.getState().data.query;e("#members-search-query",s).val(n);var r=null;i.canManage&&!n&&(r=t.api.util.template().render(e("#members-list-actions-template",s)));var u="/api/group/"+i.principalId+"/members";n&&(u="/api/search/members/"+i.principalId),o=e(".oae-list",s).infiniteScroll(u,{limit:12,q:n},"#members-template",{initialContent:r,postProcessor:function(e){return e.query=n,e},emptyListProcessor:function(){t.api.util.template().render(e("#members-noresults-template",s),{query:n},e(".oae-list",s))}})},a=function(){t.data.me.anon&&e(".oae-list-options-toggle",s).prop("disabled",!0)},f=function(){var n=e("#members-search-query",e(this)).val(),r=e.extend({},History.getState().data,{query:n}),i=e.url(History.getState().cleanUrl).attr("path")+"?q="+t.api.util.security().encodeForURL(n);return History.pushState(r,e("title").text(),i),!1},l=function(){s.on("submit","#members-search-form",f),e(window).on("oae.manageaccess.done",u),e(window).on("statechange",function(){s.is(":visible")&&u()})};l(),a(),u()}});