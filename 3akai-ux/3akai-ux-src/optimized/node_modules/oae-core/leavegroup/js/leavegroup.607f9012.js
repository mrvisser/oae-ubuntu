define(["jquery","underscore","oae.core"],function(e,t,n){return function(t,r){var i=e("#"+t),s=null,o=function(){n.api.util.template().render(e("#leavegroup-list-template",i),{groups:s},e("#leavegroup-modal-content",i)),e(".icon-spinner",i).hide()},u=function(){var t=0,r=s.length,o=0;e("#leavegroup-modal",i).modal("lock");var u=function(a){e('ul li[data-id="'+a+'"] .icon-spinner',i).show(),n.api.group.leaveGroup(a,function(f,l){e('ul li[data-id="'+a+'"] .icon-spinner',i).hide(),f?(e('ul li[data-id="'+a+'"] .icon-warning-sign',i).show(),o++):e('ul li[data-id="'+a+'"] .icon-ok',i).show(),t++;if(t!==r)u(s[t].id);else{e("#leavegroup-modal",i).modal("unlock");var c=n.api.util.template().render(e("#leavegroup-notification-title-template",i),{errCount:o,groups:s}),h=n.api.util.template().render(e("#leavegroup-notification-body-template",i),{errCount:o,groups:s});n.api.util.notification(c,h,o?"error":"success"),e(document).trigger("oae.leavegroup.done"),o===0&&e("#leavegroup-modal",i).modal("hide")}})};u(s[0].id)},a=function(){e(document).on("oae.list.sendSelection.leavegroup",function(t,n){s=n.results,e("#leavegroup-modal",i).modal({backdrop:"static"}),o()}),e(document).on("click",".oae-trigger-leavegroup",function(t){e(document).trigger("oae.list.getSelection","leavegroup")}),i.on("click","#leavegroup-leave",u)};a()}});