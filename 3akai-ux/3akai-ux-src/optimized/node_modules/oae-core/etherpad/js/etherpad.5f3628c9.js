define(["jquery","oae.core"],function(e,t){return function(n,r,i){var s=e("#"+n),o=function(){e.ajax({url:"/api/content/"+i.id+"/join",type:"POST",success:function(n){t.api.util.template().render(e("#etherpad-template",s),n,e("#etherpad-container",s))},error:function(){t.api.util.notification(t.api.i18n.translate("__MSG__CANNOT_EDIT__","etherpad"),t.api.i18n.translate("__MSG__CANNOT_EDIT_THIS_DOCUMENT__","etherpad"),"error")}})},u=function(){var n=i.latestRevision.etherpadHtml||"";t.api.util.template().render(e("#etherpad-view-mode-template",s),{etherpadHTML:n,isBlank:t.api.util.isBlank(n)},e("#etherpad-container",s))},a=function(){e("#etherpad-editor",s).remove(),e.ajax({url:"/api/content/"+i.id+"/publish",type:"POST",async:!1})},f=function(){i.isManager?(o(),e(window).on("beforeunload",a)):u()};f()}});