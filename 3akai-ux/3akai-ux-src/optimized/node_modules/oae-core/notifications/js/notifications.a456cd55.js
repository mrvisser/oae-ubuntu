define(["jquery","underscore","oae.core"],function(e,t,n){return function(t){var r=e("#"+t),i=!1,s=function(e,t){return e.image&&!t.image?-1:!e.image&&t.image?1:0},o=function(t){return e.each(t.items,function(e,t){t.actor["oae:collection"]&&t.actor["oae:collection"].sort(s)}),{results:t.items}},u=function(){var t=n.data.me.notificationsUnread||0;e(".oae-listitem:lt("+t+")",r).addClass("alert-info")},a=function(){e.ajax({url:"/api/notifications/markRead",type:"POST"})},f=function(){e("#topnavigation-notification-count").remove(),n.data.me.notificationsUnread=0},l=function(){e("#notifications-container",r).parents(".popover").removeClass("notifications-empty-container"),i&&i.kill(),i=e(".oae-list",r).infiniteScroll("/api/notifications",{limit:10},"#notifications-template",{scrollContainer:e("#notifications-container",r),postProcessor:o,postRenderer:u,emptyListProcessor:c})},c=function(){e("#notifications-container",r).parents(".popover").addClass("notifications-empty-container"),n.api.util.template().render(e("#notifications-noresults-template",r),null,e(".oae-list",r))},h=function(){e(document).on("click",".oae-trigger-notifications",function(){n.api.util.clickover(e(this),e(".notifications-widget"),{onShown:function(e){r=e,l(),a()},onHidden:f})})};h()}});