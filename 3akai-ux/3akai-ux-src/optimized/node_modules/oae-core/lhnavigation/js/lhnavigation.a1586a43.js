define(["jquery","oae.core","jquery.history"],function(e,t){return function(n){var r=e("#"+n),i=null,s=function(){e("#lhnavigation-navigation ul li",r).removeClass("active");var n=o(History.getState().data.page);e('#lhnavigation-navigation ul li[data-id="'+n.id+'"]',r).addClass("active"),e("#lhnavigation-page > div",r).hide();var i=e("#lhnavigation-page",r),s=e('div[data-id="'+n.id+'"]',i);if(s.length>0)s.show();else{i.append(t.api.util.template().render(e("#lhnavigation-page-template"),n));var u={};e.each(n.layout,function(t,n){e.each(n.widgets,function(e,t){t.settings&&(u["lhnavigation-page-"+t.id]=t.settings)})}),t.api.widget.loadWidgets(i,!1,u)}},o=function(e){for(var t=0;t<i.length;t++)if(i[t].id===e)return i[t];return i[0]},u=function(n){t.api.util.template().render(e("#lhnavigation-navigation-template"),{items:i,baseUrl:n},e("#lhnavigation-navigation"));var s=e.url(History.getState().hash),u=s.segment().pop(),a=o(u),f=s.param().q,l={page:u,_:Math.random()},c=a.title,h=e.url(History.getState().hash).attr("path");f&&(l.query=f,h+="?q="+f),History.replaceState(l,c,h),r.on("click","#lhnavigation-navigation ul li",function(){if(!e(this).hasClass("active")){var t=o(e(this).attr("data-id")),n={page:t.id},r=t.title,i=e("a",e(this)).attr("href");History.pushState(n,r,i)}return!1})};e(window).on("statechange",s),e(window).on("oae.trigger.lhnavigation",function(e,t,n){i=t,u(n)}),e(window).trigger("oae.ready.lhnavigation")}});