require(["jquery","underscore","oae.core"],function(e,t,n){var r="c:"+e.url().segment(2)+":"+e.url().segment(3),i=null,s=function(){n.api.content.getContent(r,function(e,t){if(e){e.code===401?n.api.util.redirect().accessdenied():n.api.util.redirect().notfound();return}i=t,n.api.util.setBrowserTitle(i.displayName),o(),u(),a(),n.api.util.showPage()})},o=function(){n.api.util.template().render(e("#content-clip-template"),{content:i},e("#content-clip-container")),n.data.me.anon||n.api.util.template().render(e("#content-actions-clip-template"),{content:i},e("#content-actions-clip-container"))},u=function(){e("#content-preview-container").html(""),i.resourceSubType==="file"?n.api.widget.insertWidget("filepreview",null,e("#content-preview-container"),null,i):i.resourceSubType==="link"?n.api.widget.insertWidget("linkpreview",null,e("#content-preview-container"),null,i):i.resourceSubType==="collabdoc"&&n.api.widget.insertWidget("etherpad",null,e("#content-preview-container"),null,i)},a=function(){e(document).on("oae.context.get",function(t,n){n?e(document).trigger("oae.context.send."+n,i):e(document).trigger("oae.context.send",i)}),e(document).trigger("oae.context.send",i)},f=function(e,t){i=t,o(),u()};e(document).on("oae.content.update",f);var l=function(){var e={membersTitle:n.api.i18n.translate("__MSG__SHARE_WITH__"),"private":n.api.i18n.translate("__MSG__PRIVATE__"),loggedin:n.api.util.security().encodeForHTML(i.tenant.displayName),"public":n.api.i18n.translate("__MSG__PUBLIC__")};switch(i.resourceSubType){case"file":return t.extend(e,{accessNotUpdatedBody:n.api.i18n.translate("__MSG__FILE_ACCESS_COULD_NOT_BE_UPDATED__"),accessNotUpdatedTitle:n.api.i18n.translate("__MSG__FILE_ACCESS_NOT_UPDATED__"),accessUpdatedBody:n.api.i18n.translate("__MSG__FILE_ACCESS_SUCCESSFULLY_UPDATED__"),accessUpdatedTitle:n.api.i18n.translate("__MSG__FILE_ACCESS_UPDATED__"),privateDescription:n.api.i18n.translate("__MSG__FILE_PRIVATE_DESCRIPTION__"),loggedinDescription:n.api.i18n.translate("__MSG__FILE_LOGGEDIN_DESCRIPTION__",null,{tenant:n.api.util.security().encodeForHTML(i.tenant.displayName)}),publicDescription:n.api.i18n.translate("__MSG__FILE_PUBLIC_DESCRIPTION__")});case"link":return t.extend(e,{accessNotUpdatedBody:n.api.i18n.translate("__MSG__LINK_ACCESS_COULD_NOT_BE_UPDATED__"),accessNotUpdatedTitle:n.api.i18n.translate("__MSG__LINK_ACCESS_NOT_UPDATED__"),accessUpdatedBody:n.api.i18n.translate("__MSG__LINK_ACCESS_SUCCESSFULLY_UPDATED__"),accessUpdatedTitle:n.api.i18n.translate("__MSG__LINK_ACCESS_UPDATED__"),privateDescription:n.api.i18n.translate("__MSG__LINK_PRIVATE_DESCRIPTION__"),loggedinDescription:n.api.i18n.translate("__MSG__LINK_LOGGEDIN_DESCRIPTION__",null,{tenant:n.api.util.security().encodeForHTML(i.tenant.displayName)}),publicDescription:n.api.i18n.translate("__MSG__LINK_PUBLIC_DESCRIPTION__")});case"collabdoc":return t.extend(e,{accessNotUpdatedBody:n.api.i18n.translate("__MSG__DOCUMENT_ACCESS_COULD_NOT_BE_UPDATED__"),accessNotUpdatedTitle:n.api.i18n.translate("__MSG__DOCUMENT_ACCESS_NOT_UPDATED__"),accessUpdatedBody:n.api.i18n.translate("__MSG__DOCUMENT_ACCESS_SUCCESSFULLY_UPDATED__"),accessUpdatedTitle:n.api.i18n.translate("__MSG__DOCUMENT_ACCESS_UPDATED__"),privateDescription:n.api.i18n.translate("__MSG__DOCUMENT_PRIVATE_DESCRIPTION__"),loggedinDescription:n.api.i18n.translate("__MSG__DOCUMENT_LOGGEDIN_DESCRIPTION__",null,{tenant:n.api.util.security().encodeForHTML(i.tenant.displayName)}),publicDescription:n.api.i18n.translate("__MSG__DOCUMENT_PUBLIC_DESCRIPTION__")})}},c=function(){return{contextProfile:i,messages:l(),roles:{viewer:n.api.i18n.translate("__MSG__CAN_VIEW__"),manager:n.api.i18n.translate("__MSG__CAN_MANAGE__")},api:{getMembersURL:"/api/content/"+i.id+"/members",setMembers:n.api.content.updateMembers,setVisibility:n.api.content.updateContent}}};e(document).on("click",".content-trigger-manageaccess",function(){e(document).trigger("oae.trigger.manageaccess",c())}),e(document).on("oae.manageaccess.done",function(e){o()}),e(document).on("oae.revisions.done",function(e,t,n){i=n,u(),o()}),e(document).on("oae.editcontent.done",function(e,t){i.resourceSubType==="link"?f(e,t):(i=t,o())}),s()});