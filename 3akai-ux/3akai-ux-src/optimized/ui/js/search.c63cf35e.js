require(["jquery","oae.core","jquery.history"],function(e,t){t.api.util.setBrowserTitle(t.api.i18n.translate("__MSG__SEARCH__"));var n=!1,r=function(){n&&n.kill();var r=History.getState().data.query;e(".search-query").val(r),e('#search-refine-type input[type="checkbox"]').prop("checked",!1);var i=History.getState().data.types;e.each(i,function(t,n){e('#search-refine-type input[type="checkbox"][data-type="'+n+'"]').prop("checked",!0)}),n=e(".oae-list").infiniteScroll("/api/search/general",{limit:12,q:r,resourceTypes:i,includeExternal:!t.api.config.getValue("oae-tenants","tenantprivacy","tenantprivate")},"#search-template",{postRenderer:function(t){e("#search-total-results").text(t.total)},emptyListProcessor:function(){t.api.util.template().render(e("#search-noresults-template"),{query:r},e(".oae-list"))}})},i=function(){var n=e.trim(e("#search-query").val()),r=[];e('#search-refine-type input[type="checkbox"]:checked').each(function(t,n){r.push(e(n).attr("data-type"))});var i="/search/"+t.api.util.security().encodeForURL(n);return r.length>0&&(i+="?types="+r.join(",")),History.pushState({query:n,types:r},e("title").text(),i),!1},s=function(){var t=History.getState().cleanUrl,n=e.url(t),r=n.segment().slice(1).join("/"),i=(n.param().types||"").split(",");History.replaceState({query:r,types:i,_:Math.random()},e("title").text(),t)},o=function(){e(document).on("submit","#search-form",i),e("#search-refine-type").on("change",'input[type="checkbox"]',i),e(window).on("statechange",r)};o(),s()});